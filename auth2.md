# auth2


## 许可类型

### 授权码

### 隐式许可

### 客户端凭据许可

### 资源拥有者凭据许可


## 相关角色

### 资源拥有者

### 第三方软件

### 授权服务

### 受保护资源


## 安全

### csrf 攻击

恶意软件让浏览器向已完成用户身份认证的网站发起请求，并执行有害操作。例如：攻击者先通过自己的第三方软件账号做了微信绑定操作，也就可以使用自己的微信账号来登录第三方软件来。然后，攻击者在发起了一个授权请求后构造了一个攻击页面，诱导用户 G 点击

```html
<html>
    <img src="https://xxx/callback?code=codeA">
</html>
```

而用户 G 已经使用第三方软件的账号登录了第三方软件，此时正要去做跟微信账号的绑定。如果这个时候他刚好点击了攻击者设置的这个恶意页面，那么后面换取授权的访问令牌 access_token，以及通过 access_token 获取的信息就是攻击者的了

这就相当于用户将自己的第三方软件账号跟攻击者的微信账号绑定在了一起，这样攻击者就能通过自己的微信账号来登录用户的第三方软件了

使用随机值为 state 参数，当第三方软件请求授权码的时候附带一个自己生成的 state 参数，同时授权服务也要按照规则将这个随机 state 值跟授权码 code 一起返回给第三方软件。这样，第三方软件接收到授权码的时候，就对 state 参数进行校验，不同就拒绝后续流程

本质就是：攻击者用自己的授权码 codeA 的值，通过 csrf 攻击，替换了用户 G 的授权码的值

### xss 攻击

xss 攻击的主要手段是将恶意脚步注入到请求的输入中

解决方案：对非法信息做转义过滤

### 水平越权

水平越权是指在请求受保护资源服务数据的时候，服务端应用程序未校验这条数据是否归属于当前授权的请求用户

### 授权码失窃

解决方案
1. 授权服务在进行授权码校验的时候，也对 app_id 进行校验
2. 第三方软件在使用过一次校验码之后，授权服务删除授权码

### 重定向 uri 被篡改

解决方案：对重定向 uri 进行完整性校验
