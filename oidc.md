# OIDC

OpenID Connect

EU: 最终用户
RP: 认证服务和依赖方
OP: 身份认证服务方

## 通信流程

1. 访问第三方软件
2. 第三方软件重定向到认证服务，认证服务重定向到登录页面
3. 用户登录，认证服务记录登录状态，生成 code 值
4. 认证服务重定向到第三方软件，附带 code 值
5. 第三方软件发送 post 请求，附带 code 值
6. 认证服务生成 id token、access_token 并返回
7. 第三方软件记录登录状态


## id 令牌

id 令牌是一个 jwt 格式的令牌，需要以下 5 个 jwt 声明的参数：
iss: 令牌的颁发者，其值就是身份认证服务的 URL
sub: 令牌的主题，其值是一个能够代表最终用户的全局唯一标识符
aud: 令牌的目标受众，其值是第三方软件的 app_id
exp: 令牌的到期时间戳，所有 id 令牌都会有一个过期时间
iat: 颁发令牌的时间戳

第三方软件解析并验证 id 令牌的合法性之后，保留其中的 payload 部分

id 令牌 id_token 是在访问令牌 access_token 基础上的补充，而不是替换访问令牌。而且，这两种令牌还具有不同的生命周期，id 令牌通常会很快过期。id 令牌代表一个单独的身份认证结果，并且永远不会传递给外部服务，而访问令牌可以在用户离开后的很长时间内用于获取受保护资源


## 单点登录

1. 访问第三方软件
2. 第三方软件重定向到认证服务，然后跳转到登录页面
3. 用户登录
4. 认证服务重定向到第三方软件，附带 code 信息
5. 第三方软件发送 post 请求，附带 code 信息
6. 认证服务生成 access_token、id 并返回给第三方软件
7. 第三方软件记录登录状态
